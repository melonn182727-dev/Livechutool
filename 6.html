<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>CuTools - Kho Tools & C√¥ng c·ª• D·ª± ƒëo√°n AI T√†i X·ªâu Ch√≠nh X√°c Nh·∫•t 2025</title>
    <meta name="description" content="CuTools - N·ªÅn t·∫£ng c√¥ng c·ª• game h√†ng ƒë·∫ßu Vi·ªát Nam v·ªõi AI d·ª± ƒëo√°n T√†i X·ªâu ƒë·ªô ch√≠nh x√°c cao, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng 789.club, Sun.win, LC79, B52, Hit.club. B·∫£o m·∫≠t tuy·ªát ƒë·ªëi, n·∫°p r√∫t nhanh ch√≥ng, h·ªó tr·ª£ 24/7. D√πng th·ª≠ mi·ªÖn ph√≠ ngay!">
    <meta name="keywords" content="CuTools, tool t√†i x·ªâu, tool t√†i x·ªâu mi·ªÖn ph√≠, hack t√†i x·ªâu, d·ª± ƒëo√°n t√†i x·ªâu, AI t√†i x·ªâu, c√¥ng c·ª• game, 789club, Sun.win, LC79, B52, Hit.club, nh√† c√°i uy t√≠n, n·∫°p r√∫t nhanh, game online, tool game, userscript, auto t√†i x·ªâu">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="author" content="CuTools Team">
    <meta name="language" content="vi">
    <meta name="geo.region" content="VN">
    <meta name="geo.placename" content="Vietnam">
    <link rel="canonical" href="https://cutools.xyz/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="logo.jpeg">
    <link rel="shortcut icon" href="logo.jpeg">
    <link rel="apple-touch-icon" href="logo.jpeg">
    <link rel="apple-touch-icon" sizes="180x180" href="logo.jpeg">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cutools.xyz/">
    <meta property="og:site_name" content="CuTools">
    <meta property="og:title" content="CuTools - C√¥ng c·ª• d·ª± ƒëo√°n t√†i x·ªâu th√¥ng minh AI 2025">
    <meta property="og:description" content="N·ªÅn t·∫£ng c√¥ng c·ª• game h√†ng ƒë·∫ßu Vi·ªát Nam v·ªõi AI d·ª± ƒëo√°n T√†i X·ªâu ƒë·ªô ch√≠nh x√°c cao, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng 789.club, Sun.win, LC79, B52, Hit.club. B·∫£o m·∫≠t tuy·ªát ƒë·ªëi, n·∫°p r√∫t nhanh ch√≥ng, h·ªó tr·ª£ 24/7.">
    <meta property="og:image" content="https://i.ibb.co/bg7kzNML/photo-6129738584706190438-y.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="vi_VN">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://cutools.xyz/">
    <meta name="twitter:title" content="CuTools - C√¥ng c·ª• d·ª± ƒëo√°n t√†i x·ªâu th√¥ng minh AI 2025">
    <meta name="twitter:description" content="N·ªÅn t·∫£ng c√¥ng c·ª• game h√†ng ƒë·∫ßu Vi·ªát Nam v·ªõi AI d·ª± ƒëo√°n T√†i X·ªâu ƒë·ªô ch√≠nh x√°c cao, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng 789.club, Sun.win, LC79, B52, Hit.club. B·∫£o m·∫≠t tuy·ªát ƒë·ªëi, n·∫°p r√∫t nhanh ch√≥ng, h·ªó tr·ª£ 24/7.">
    <meta name="twitter:image" content="https://i.ibb.co/bg7kzNML/photo-6129738584706190438-y.jpg">
    <meta name="twitter:creator" content="@CuTools">
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CuTools">
    <meta name="format-detection" content="telephone=no">
    
    <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="serve_static.php?file=style.css&v=1765238516">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Anti-DevTools Protection -->
        <script src="serve_js.php?file=anti-devtools.js&v=1765265629"></script>
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "CuTools",
        "url": "https://cutools.xyz",
        "logo": {
            "@type": "ImageObject",
            "url": "https://cutools.xyz/logo-cutools.png",
            "width": 512,
            "height": 512
        },
        "description": "N·ªÅn t·∫£ng c√¥ng c·ª• game h√†ng ƒë·∫ßu Vi·ªát Nam v·ªõi AI d·ª± ƒëo√°n T√†i X·ªâu ƒë·ªô ch√≠nh x√°c cao, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng",
        "foundingDate": "2024",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "2862 Larimer St",
            "addressLocality": "Denver",
            "addressRegion": "Colorado",
            "postalCode": "80205",
            "addressCountry": "US"
        },
        "email": "info@cutools.xyz",
        "telephone": "+84382453807",
        "sameAs": [
            "https://t.me/mryanhdz",
            "https://zalo.me/0382453807"
        ],
        "contactPoint": [
            {
                "@type": "ContactPoint",
                "contactType": "Customer Support",
                "telephone": "+84382453807",
                "email": "info@cutools.xyz",
                "areaServed": "VN",
                "availableLanguage": ["vi", "Vietnamese"],
                "hoursAvailable": {
                    "@type": "OpeningHoursSpecification",
                    "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
                    "opens": "00:00",
                    "closes": "23:59"
                }
            }
        ],
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "reviewCount": "1247",
            "bestRating": "5",
            "worstRating": "1"
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "CuTools",
        "url": "https://cutools.xyz",
        "description": "N·ªÅn t·∫£ng c√¥ng c·ª• game v√† AI d·ª± ƒëo√°n T√†i X·ªâu h√†ng ƒë·∫ßu Vi·ªát Nam",
        "inLanguage": "vi",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://cutools.xyz/?s={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "CuTools - AI Prediction Tool",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "VND",
            "priceValidUntil": "2026-12-31",
            "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1247",
            "bestRating": "5",
            "worstRating": "1"
        },
        "screenshot": "https://cutools.xyz/logo-cutools.png",
        "description": "C√¥ng c·ª• AI d·ª± ƒëo√°n T√†i X·ªâu th√¥ng minh v·ªõi ƒë·ªô ch√≠nh x√°c cao, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng 789.club, Sun.win, LC79, B52, Hit.club",
        "featureList": [
            "AI d·ª± ƒëo√°n T√†i X·ªâu",
            "H·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng",
            "Kho userscript mi·ªÖn ph√≠",
            "N·∫°p r√∫t t·ª± ƒë·ªông",
            "H·ªó tr·ª£ 24/7"
        ]
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "CuTools",
        "image": "https://cutools.xyz/logo-cutools.png",
        "@id": "https://cutools.xyz",
        "url": "https://cutools.xyz",
        "telephone": "+84382453807",
        "priceRange": "Free - 199,000 VND",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "2862 Larimer St",
            "addressLocality": "Denver",
            "addressRegion": "CO",
            "postalCode": "80205",
            "addressCountry": "US"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 39.7653,
            "longitude": -104.9863
        },
        "openingHoursSpecification": {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            "opens": "00:00",
            "closes": "23:59"
        }
    }
    </script>
</head>
<body>
    <canvas id="snow-canvas"></canvas>
    
        <!-- Header -->
    <header class="header-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button id="sidebar-toggle" class="icon-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div id="notification-wrapper" style="position: relative;">
                <button id="notification-bell" class="icon-btn" title="Th√¥ng b√°o" style="position: relative;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span id="notification-badge" class="notification-badge" style="display: none;"></span>
                </button>
                <div id="notification-dropdown" class="notification-dropdown">
                    <div class="notification-dropdown-header">
                        <span>Th√¥ng b√°o</span>
                        <button id="mark-all-read" class="mark-all-read-btn">ƒê·ªçc t·∫•t c·∫£</button>
                    </div>
                    <div id="notification-list" class="notification-list">
                        <div class="notification-empty">Kh√¥ng c√≥ th√¥ng b√°o m·ªõi</div>
                    </div>
                </div>
            </div>
        </div>
        <a href="?page=home" style="position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center;">
            <img src="logo-cutools.png" alt="CuTools" class="header-logo-img" style="height: 55px; width: auto;">
        </a>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button id="theme-toggle" class="icon-btn">
                <svg id="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg id="moon-icon" class="hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <a href="?page=logout" class="icon-btn" style="color: #ef4444;" title="ƒêƒÉng xu·∫•t">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
            </a>
        </div>
    </header>

    <!-- Sidebar -->
<div id="sidebar-overlay" class="sidebar-overlay"></div>
<aside id="sidebar" class="sidebar">
    <div class="sidebar-content">
        <!-- User Card -->
        <div class="user-card">
            <div class="user-avatar">
                                    <img src="profile/IMG_1595.png?t=1763815886" alt="Avatar" class="user-avatar-img">
                            </div>
            <div class="user-info">
                <div class="user-name">NGUYEN THI DAI</div>
                <div class="user-id">ID: MDULE</div>
                <div class="user-balance">0 ƒë</div>
            </div>
        </div>

        <!-- Menu -->
        <nav class="sidebar-menu">
            <!-- T√†i Kho·∫£n -->
            <div class="menu-section">
                <div class="menu-section-title">T√†i Kho·∫£n</div>
                <a href="?page=home" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>Trang ch·ªß</span>
                </a>
                <a href="?page=profile" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Th√¥ng tin c√° nh√¢n</span>
                </a>
                <a href="?page=deposit" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <span>N·∫°p ti·ªÅn</span>
                </a>
                <a href="?page=buykey" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                    </svg>
                    <span>Mua G√≥i</span>
                </a>
                <a href="?page=keymanager" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    <span>Qu·∫£n l√Ω Key</span>
                </a>
                <a href="?page=history" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>L·ªãch s·ª≠</span>
                </a>
            </div>
            
            <!-- C√¥ng C·ª• -->
            <div class="menu-section">
                <div class="menu-section-title">C√¥ng C·ª•</div>
                <a href="?page=games" class="menu-item menu-item-vip">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                        <line x1="9" y1="9" x2="9.01" y2="9"></line>
                        <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                    <span>Ch∆°i game</span>
                    <span class="vip-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        VIP
                    </span>
                </a>
                <a href="?page=userscripts" class="menu-item menu-item-vip">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                    </svg>
                    <span>Kho Tools</span>
                    <span class="vip-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        VIP
                    </span>
                </a>
                <a href="?page=tool_apk" class="menu-item menu-item-vip">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"></path>
                        <path d="M3 9V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v2"></path>
                        <circle cx="12" cy="13" r="2"></circle>
                    </svg>
                    <span>Tools APK</span>
                    <span class="vip-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        VIP
                    </span>
                </a>
                <a href="?page=tool_bot" class="menu-item menu-item-vip">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 0 0-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
                    </svg>
                    <span>Bot Telegram</span>
                    <span class="vip-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        VIP
                    </span>
                </a>
                <a href="?page=tool_free" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <span>Tool Free</span>
                    <span class="free-badge" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: auto;">FREE</span>
                </a>
            </div>

            <!-- Khuy·∫øn M√£i -->
            <div class="menu-section">
                <div class="menu-section-title">Khuy·∫øn M√£i</div>
                <a href="?page=gift_code" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 12 20 22 4 22 4 12"></polyline>
                        <rect x="2" y="7" width="20" height="5"></rect>
                        <line x1="12" y1="22" x2="12" y2="7"></line>
                        <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                        <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
                    </svg>
                    <span>Nh·∫≠p Gift Code</span>
                </a>
                <a href="?page=events" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span>S·ª± Ki·ªán</span>
                </a>
                <a href="?page=referral" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Gi·ªõi Thi·ªáu B·∫°n B√®</span>
                </a>
            </div>

            <!-- C·ªông ƒê·ªìng -->
            <div class="menu-section">
                <div class="menu-section-title">C·ªông ƒê·ªìng</div>
                <a href="?page=blog" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    <span>Tin T·ª©c & Blog</span>
                </a>
                <a href="?page=testimonials" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    <span>ƒê√°nh Gi√°</span>
                </a>
                <a href="?page=faq" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <span>FAQ</span>
                </a>
            </div>

            <!-- H·ªó Tr·ª£ -->
            <div class="menu-section">
                <div class="menu-section-title">H·ªó Tr·ª£</div>
                <a href="?page=guide" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <span>H∆∞·ªõng d·∫´n</span>
                </a>
                <a href="?page=support" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>H·ªó tr·ª£</span>
                </a>
                <a href="https://t.me/CuTools" target="_blank" class="menu-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 0 0-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
                    </svg>
                    <span>Nh√≥m Telegram</span>
                </a>
            </div>
        </nav>
    </div>
</aside>
    
    <div class="main-container">
        
<main class="main-content">
    <div class="page-container">
        <div class="page-header">
            <h2 class="page-title">N·∫°p ti·ªÅn v√†o t√†i kho·∫£n</h2>
            <p class="page-subtitle">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</p>
        </div>

        <div class="balance-display-large">
            <div class="balance-label">S·ªë d∆∞ hi·ªán t·∫°i</div>
            <div class="balance-amount-large">0 ƒë</div>
        </div>

        <div id="recharge-section" class="recharge-section" style="display: none;">
            <h3 class="section-title">Ch·ªçn m·ªánh gi√°</h3>
            <div id="packages-container" class="recharge-packages">
                <!-- Packages will be loaded dynamically -->
            </div>
        </div>

        <div class="payment-section">
            <h3 class="section-title">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
            <div class="payment-methods">
                                <div class="payment-method " 
                     data-method="mbbank" 
                                          onclick="selectPaymentMethod('mbbank', 'MBBank', this)"
                                          style="">
                                            <div class="payment-icon" style="background: #004db3; padding: 8px;">
                            <img src="mbbank-logo.png" alt="MBBank" style="width: 48px; height: 48px; object-fit: contain; border-radius: 8px;">
                        </div>
                                        <div class="payment-name">
                        MBBank                                            </div>
                                        <div class="payment-check">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                                    </div>
                                <div class="payment-method payment-maintenance" 
                     data-method="card" 
                                          style="opacity: 0.6; cursor: not-allowed;">
                                            <div class="payment-icon" style="background: #34a853">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                                <path d="M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM3 6h18v2H3V6zm0 6h18v6H3v-6z"/>
                            </svg>
                        </div>
                                        <div class="payment-name">
                        Th·∫ª c√†o ƒëi·ªán tho·∫°i                                                <span style="display: block; font-size: 11px; color: #f59e0b; margin-top: 4px;">ƒêang b·∫£o tr√¨</span>
                                            </div>
                                        <div class="payment-check" style="background: #f59e0b;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01"></path>
                        </svg>
                    </div>
                                    </div>
                            </div>
        </div>

        <!-- Card Provider Selection (Hidden by default) -->
        <div id="card-provider-section" class="payment-section" style="display: none;">
            <h3 class="section-title">Ch·ªçn nh√† m·∫°ng</h3>
            <div class="card-providers">
                                <div class="card-provider" data-provider="viettel" data-fee="15" onclick="selectCardProvider('viettel', 15, this)">
                    <div class="provider-name">Viettel</div>
                    <div class="provider-fee">Ph√≠: 15%</div>
                    <div class="provider-check">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                </div>
                                <div class="card-provider" data-provider="vinaphone" data-fee="16" onclick="selectCardProvider('vinaphone', 16, this)">
                    <div class="provider-name">Vinaphone</div>
                    <div class="provider-fee">Ph√≠: 16%</div>
                    <div class="provider-check">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                </div>
                                <div class="card-provider" data-provider="mobifone" data-fee="18" onclick="selectCardProvider('mobifone', 18, this)">
                    <div class="provider-name">Mobifone</div>
                    <div class="provider-fee">Ph√≠: 18%</div>
                    <div class="provider-check">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                </div>
                            </div>
        </div>

        <!-- Card Input Form (Hidden by default) -->
        <div id="card-input-section" class="payment-section" style="display: none;">
            <h3 class="section-title">Th√¥ng tin th·∫ª c√†o</h3>
            <div class="card-input-form">
                <div class="form-group">
                    <label>S·ªë serial:</label>
                    <input type="text" id="card-serial" placeholder="Nh·∫≠p s·ªë serial th·∫ª..." class="card-input">
                </div>
                <div class="form-group">
                    <label>M√£ th·∫ª:</label>
                    <input type="text" id="card-code" placeholder="Nh·∫≠p m√£ th·∫ª..." class="card-input">
                </div>
            </div>
        </div>

        <div id="recharge-summary" class="recharge-summary" style="display: none;">
            <div class="summary-row">
                <span>S·ªë ti·ªÅn n·∫°p:</span>
                <span id="recharge-amount">0 ƒë</span>
            </div>
            <div class="summary-row bonus-row">
                <span>Ti·ªÅn th∆∞·ªüng:</span>
                <span id="bonus-amount">0 ƒë</span>
            </div>
            <div id="fee-row" class="summary-row fee-row" style="display: none;">
                <span>Ph√≠ chi·∫øt kh·∫•u (<span id="fee-percent">0</span>%):</span>
                <span id="fee-amount" style="color: #ef4444;">-0 ƒë</span>
            </div>
            <div class="summary-divider"></div>
            <div class="summary-row total-row">
                <span>T·ªïng nh·∫≠n ƒë∆∞·ª£c:</span>
                <span id="total-amount">0 ƒë</span>
            </div>
        </div>

        <button id="btn-proceed-payment" class="btn-proceed-payment" disabled onclick="proceedPayment()" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Ti·∫øn h√†nh thanh to√°n
        </button>

        <!-- MBBank QR Code Section -->
        <div id="mbbank-qr-section" style="display: none; margin-top: 20px;">
            <div style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); padding: 20px; color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Qu√©t m√£ QR thanh to√°n</h3>
                        <button onclick="cancelMBBankTransaction()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                            H·ªßy
                        </button>
                    </div>
                </div>

                <div style="padding: 24px;">
                    <!-- QR Code -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 16px; display: inline-block;">
                            <img id="qr-code-image" src="" alt="QR Code" style="width: 240px; height: 240px; display: block;">
                        </div>
                        <button onclick="downloadQRCode()" style="margin-top: 12px; background: #0ea5e9; border: none; color: white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            T·∫£i ·∫£nh QR
                        </button>
                    </div>

                    <!-- Info Cards -->
                    <div style="display: grid; gap: 12px; margin-bottom: 16px;">
                        <!-- Account Number -->
                        <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; font-weight: 500;">S·ªë t√†i kho·∫£n</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #f1f5f9; font-family: 'Courier New', monospace;">8600112233</div>
                                    <div style="font-size: 13px; color: #cbd5e1; margin-top: 4px;">Y KHAM NHAY BYA</div>
                                </div>
                                <button onclick="copyToClipboard('8600112233', 'ƒê√£ sao ch√©p STK')" style="background: #0ea5e9; border: none; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; white-space: nowrap; display: inline-flex; align-items: center; gap: 6px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                    Sao ch√©p
                                </button>
                            </div>
                        </div>

                        <!-- Transaction Code -->
                        <div style="background: rgba(251, 191, 36, 0.1); border: 2px solid #fbbf24; border-radius: 12px; padding: 16px;">
                            <div style="font-size: 12px; color: #fbbf24; margin-bottom: 6px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                    <line x1="12" y1="9" x2="12" y2="13"></line>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                N·ªòI DUNG CHUY·ªÇN KHO·∫¢N
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                                <div id="transaction-code" style="flex: 1; font-size: 18px; font-weight: 700; color: #fbbf24; font-family: 'Courier New', monospace; word-break: break-all;"></div>
                                <button onclick="copyTransactionCode()" style="background: #fbbf24; border: none; color: #0f172a; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; white-space: nowrap; display: inline-flex; align-items: center; gap: 6px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                    Sao ch√©p
                                </button>
                            </div>
                            <div style="font-size: 11px; color: #fbbf24; margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4"></path>
                                    <path d="M12 8h.01"></path>
                                </svg>
                                Vui l√≤ng kh√¥ng thay ƒë·ªïi n·ªôi dung!
                            </div>
                        </div>

                        <!-- Important Warnings -->
                        <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444; border-radius: 12px; padding: 16px;">
                            <div style="font-size: 13px; color: #ef4444; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                    <line x1="12" y1="9" x2="12" y2="13"></line>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                L∆ØU √ù QUAN TR·ªåNG
                            </div>
                            <ul style="margin: 0; padding-left: 18px; color: #fca5a5; font-size: 12px; line-height: 1.8;">
                                <li>N·∫°p t·ªëi thi·ªÉu: <strong style="color: #fbbf24;">10,000 ƒë</strong></li>
                                <li>N·∫°p d∆∞·ªõi 10,000 ƒë s·∫Ω <strong style="color: #ef4444;">KH√îNG ƒê∆Ø·ª¢C HO√ÄN</strong></li>
                                <li>Sai n·ªôi dung chuy·ªÉn kho·∫£n s·∫Ω <strong style="color: #ef4444;">KH√îNG ƒê∆Ø·ª¢C C·ªòNG TI·ªÄN</strong></li>
                                <li>H·ªá th·ªëng t·ª± ƒë·ªông ki·ªÉm tra giao d·ªãch m·ªói 3 gi√¢y</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Check Status Button -->
                    <div style="text-align: center; margin-top: 16px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="reportPaymentError()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; color: white; padding: 12px 24px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            B√°o l·ªói
                        </button>
                        <button id="btn-check-status" onclick="checkTransactionStatus()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; color: white; padding: 12px 24px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            Ki·ªÉm tra l·∫°i
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #94a3b8; margin-top: 8px; text-align: center;">B·∫•m "Ki·ªÉm tra l·∫°i" n·∫øu b·∫°n ƒë√£ chuy·ªÉn ti·ªÅn | B·∫•m "B√°o l·ªói" n·∫øu g·∫∑p v·∫•n ƒë·ªÅ</p>
                </div>
            </div>
        </div>

        <!-- MBBank History Section -->
        <div id="mbbank-history-section" style="display: none; margin-top: 20px;">
            <div class="payment-info">
                <div class="info-card-header">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <h3>L·ªãch s·ª≠ n·∫°p MBBank</h3>
                </div>
                <div id="mbbank-history-list" class="card-history-list">
                    <p style="text-align: center; color: #94a3b8; padding: 20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ giao d·ªãch</p>
                </div>
            </div>
        </div>

        <!-- Card History Section -->
        <div id="card-history-section" style="display: none; margin-top: 20px;">
            <div class="payment-info">
                <div class="info-card-header">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M2 12h20"></path>
                    </svg>
                    <h3>L·ªãch s·ª≠ n·∫°p th·∫ª</h3>
                </div>
                <div id="card-history-list" class="card-history-list">
                    <p style="text-align: center; color: #94a3b8; padding: 20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ n·∫°p th·∫ª</p>
                </div>
            </div>
        </div>

        <div class="payment-info">
            <div class="info-card-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <h3>H∆∞·ªõng d·∫´n n·∫°p ti·ªÅn</h3>
            </div>
            <ul class="info-list">
                <li>Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n ph√π h·ª£p</li>
                <li><strong>MBBank:</strong> N·∫°p t·ªëi thi·ªÉu 10,000 ƒë - Chuy·ªÉn kho·∫£n ƒë√∫ng n·ªôi dung</li>
                <li><strong>Th·∫ª c√†o:</strong> N·∫°p t·ª´ 100,000 ƒë tr·ªü l√™n ƒë∆∞·ª£c t·∫∑ng th√™m ti·ªÅn th∆∞·ªüng</li>
                <li>Ph√≠ chi·∫øt kh·∫•u th·∫ª c√†o: Viettel 15%, Vinaphone 16%, Mobifone 18%</li>
                <li style="color: #ef4444;"><strong>MBBank:</strong> N·∫°p d∆∞·ªõi 10,000 ƒë s·∫Ω kh√¥ng ƒë∆∞·ª£c ho√†n</li>
                <li style="color: #ef4444;"><strong>MBBank:</strong> Sai n·ªôi dung chuy·ªÉn kho·∫£n s·∫Ω kh√¥ng c·ªông ti·ªÅn</li>
                <li>Li√™n h·ªá h·ªó tr·ª£ n·∫øu g·∫∑p v·∫•n ƒë·ªÅ: <a href="?page=support">t·∫°i ƒë√¢y</a></li>
            </ul>
        </div>
    </div>
</main>

<!-- Error Report Modal -->
<div id="errorReportModal" class="error-modal-overlay" onclick="if(event.target === this) closeErrorReportModal()">
    <div class="error-modal-content">
        <div class="error-modal-header">
            <h2 class="error-modal-title">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <circle cx="12" cy="17" r="0.5" fill="#ef4444"></circle>
                </svg>
                B√°o l·ªói giao d·ªãch
            </h2>
            <button onclick="closeErrorReportModal()" class="error-modal-close">‚úï</button>
        </div>
        
        <div class="error-warning-box">
            <div class="error-warning-text">
                ‚ö†Ô∏è Vui l√≤ng m√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ b·∫°n g·∫∑p ph·∫£i. Admin s·∫Ω xem x√©t v√† x·ª≠ l√Ω trong th·ªùi gian s·ªõm nh·∫•t.
            </div>
        </div>
        
        <div class="error-info-box">
            <div class="error-info-text">
                üì± <strong>H·ªó tr·ª£ Android:</strong> N·∫øu b·∫°n d√πng Android, h√£y ghi r√µ phi√™n b·∫£n h·ªá ƒëi·ªÅu h√†nh v√† tr√¨nh duy·ªát ƒëang s·ª≠ d·ª•ng ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ nhanh h∆°n.
            </div>
        </div>
        
        <div class="error-form-group">
            <label class="error-form-label">M√¥ t·∫£ v·∫•n ƒë·ªÅ</label>
            <textarea id="error-description" placeholder="V√≠ d·ª•: T√¥i ƒë√£ chuy·ªÉn ti·ªÅn nh∆∞ng ch∆∞a th·∫•y c·∫≠p nh·∫≠t. T√¥i ƒëang d√πng Android 13, Chrome..." class="error-textarea"></textarea>
        </div>
        
        <div class="error-form-group">
            <label class="error-form-label">·∫¢nh minh ch·ª©ng (T·ªëi ƒëa 3 ·∫£nh)</label>
            <input type="file" id="error-images" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
            <button onclick="document.getElementById('error-images').click()" class="error-upload-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                Ch·ªçn ·∫£nh
            </button>
            <div id="image-preview-container" class="error-image-preview">
                <!-- Image previews will appear here -->
            </div>
        </div>
        
        <div class="error-modal-buttons">
            <button onclick="closeErrorReportModal()" class="error-btn-cancel">H·ªßy</button>
            <button onclick="submitErrorReport()" class="error-btn-submit">G·ª≠i b√°o c√°o</button>
        </div>
    </div>
</div>

<style>
.error-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    padding: 16px;
}

.error-modal-content {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 16px;
    padding: 20px;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(239, 68, 68, 0.4);
}

.error-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.error-modal-title {
    margin: 0;
    font-size: 18px;
    color: white;
    display: flex;
    align-items: center;
    gap: 10px;
}

.error-modal-title svg {
    width: 24px;
    height: 24px;
}

.error-modal-close {
    background: none;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    font-size: 22px;
    padding: 0;
    width: 28px;
    height: 28px;
}

.error-warning-box {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 14px;
}

.error-warning-text {
    color: #fca5a5;
    font-size: 13px;
    line-height: 1.5;
}

.error-info-box {
    background: rgba(14, 165, 233, 0.1);
    border: 1px solid rgba(14, 165, 233, 0.3);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 14px;
}

.error-info-text {
    color: #7dd3fc;
    font-size: 12px;
    line-height: 1.5;
}

.error-form-group {
    margin-bottom: 16px;
}

.error-form-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: #e2e8f0;
    margin-bottom: 8px;
}

.error-textarea {
    width: 100%;
    height: 100px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 10px 12px;
    color: white;
    font-size: 13px;
    resize: vertical;
    font-family: inherit;
    box-sizing: border-box;
}

.error-upload-btn {
    width: 100%;
    background: rgba(14, 165, 233, 0.1);
    border: 2px dashed rgba(14, 165, 233, 0.3);
    color: #0ea5e9;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.error-image-preview {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 10px;
}

.error-modal-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.error-btn-cancel {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: #e2e8f0;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
}

.error-btn-submit {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border: none;
    color: white;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
}

@media (max-width: 480px) {
    .error-modal-content {
        padding: 16px;
        border-radius: 12px;
    }
    
    .error-modal-title {
        font-size: 16px;
    }
    
    .error-modal-title svg {
        width: 20px;
        height: 20px;
    }
    
    .error-warning-text,
    .error-info-text {
        font-size: 12px;
    }
    
    .error-textarea {
        height: 80px;
        font-size: 12px;
    }
}
</style>

<!-- Custom Amount Modal -->
<div id="customAmountModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="if(event.target === this) closeCustomAmountModal()">
    <div style="background: white; border-radius: 16px; padding: 24px; width: 90%; max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1e293b;">Nh·∫≠p s·ªë ti·ªÅn t√πy ch·ªânh</h3>
            <button onclick="closeCustomAmountModal()" style="background: none; border: none; cursor: pointer; font-size: 24px; color: #64748b;">&times;</button>
        </div>
        <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 14px; font-weight: 500; color: #475569; margin-bottom: 8px;">S·ªë ti·ªÅn (VNƒê)</label>
            <input type="number" id="customAmountInput" placeholder="Nh·∫≠p s·ªë ti·ªÅn..." style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; box-sizing: border-box;" onkeypress="if(event.key === 'Enter') confirmCustomAmount()">
            <p id="customAmountHint" style="margin: 8px 0 0 0; font-size: 12px; color: #64748b;"></p>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button onclick="closeCustomAmountModal()" style="flex: 1; padding: 12px; background: #f1f5f9; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; color: #475569;">H·ªßy</button>
            <button onclick="confirmCustomAmount()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; cursor: pointer; font-weight: 600; color: white;">X√°c nh·∫≠n</button>
        </div>
    </div>
</div>

<script>
const mbbankPackages = [];
const cardPackages = [{"amount":20000,"bonus":0},{"amount":50000,"bonus":10000},{"amount":100000,"bonus":20000},{"amount":200000,"bonus":40000},{"amount":500000,"bonus":80000}];

let selectedAmount = 0;
let selectedBonus = 0;
let selectedMethod = '';
let selectedProvider = '';
let selectedFee = 0;
let isCardMethod = false;
let hasPendingTransaction = false;
let autoCheckInterval = null;

// Load initial packages (MBBank by default)
loadPackages(mbbankPackages);

function loadPackages(packages) {
    const container = document.getElementById('packages-container');
    container.innerHTML = '';
    
    packages.forEach(pkg => {
        const div = document.createElement('div');
        div.className = 'recharge-package';
        div.onclick = function(e) { selectPackage(pkg.amount, pkg.bonus, this); };
        
        let html = `<div class="package-amount">${pkg.amount.toLocaleString('vi-VN')} ƒë</div>`;
        if (pkg.bonus > 0) {
            html += `<div class="package-bonus">+${pkg.bonus.toLocaleString('vi-VN')} ƒë</div>`;
        }
        div.innerHTML = html;
        container.appendChild(div);
    });
    
    // Add custom package
    const customDiv = document.createElement('div');
    customDiv.className = 'recharge-package custom-package';
    customDiv.onclick = function(e) { showCustomAmount(this); };
    customDiv.innerHTML = `
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        <div class="package-amount">T√πy ch·ªânh</div>
    `;
    container.appendChild(customDiv);
}

function selectPackage(amount, bonus, element) {
    selectedAmount = amount;
    selectedBonus = bonus;
    updateSummary();
    
    document.querySelectorAll('.recharge-package').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
}

let customAmountElement = null;

function showCustomAmount(element) {
    customAmountElement = element;
    const minAmount = isCardMethod ? 20000 : 10000;
    document.getElementById('customAmountHint').textContent = `S·ªë ti·ªÅn t·ªëi thi·ªÉu: ${minAmount.toLocaleString('vi-VN')} ƒë`;
    document.getElementById('customAmountInput').value = '';
    document.getElementById('customAmountModal').style.display = 'flex';
    setTimeout(() => document.getElementById('customAmountInput').focus(), 100);
}

function closeCustomAmountModal() {
    document.getElementById('customAmountModal').style.display = 'none';
    customAmountElement = null;
}

function confirmCustomAmount() {
    const minAmount = isCardMethod ? 20000 : 10000;
    const amount = document.getElementById('customAmountInput').value;
    
    if (!amount || isNaN(amount)) {
        alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá');
        return;
    }
    
    const numAmount = parseInt(amount);
    if (numAmount < minAmount) {
        alert(`S·ªë ti·ªÅn n·∫°p t·ªëi thi·ªÉu l√† ${minAmount.toLocaleString('vi-VN')} ƒë`);
        return;
    }
    
    selectedAmount = numAmount;
    // Calculate bonus for custom amount
    if (isCardMethod) {
        selectedBonus = numAmount >= 100000 ? Math.floor(numAmount * 0.2) : 0;
    } else {
        if (numAmount >= 100000) selectedBonus = 20000;
        else if (numAmount >= 50000) selectedBonus = 10000;
        else if (numAmount >= 25000) selectedBonus = 5000;
        else selectedBonus = 0;
    }
    updateSummary();
    
    document.querySelectorAll('.recharge-package').forEach(el => el.classList.remove('selected'));
    if (customAmountElement) {
        customAmountElement.classList.add('selected');
    }
    
    closeCustomAmountModal();
}

function selectPaymentMethod(methodId, methodName, element) {
    selectedMethod = methodId;
    isCardMethod = (methodId === 'card');
    
    document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    
    // Reset selections
    selectedAmount = 0;
    selectedBonus = 0;
    selectedProvider = '';
    selectedFee = 0;
    
    // Show/hide sections based on payment method
    if (isCardMethod) {
        document.getElementById('recharge-section').style.display = 'block';
        document.getElementById('recharge-summary').style.display = 'block';
        document.getElementById('btn-proceed-payment').style.display = 'flex';
        loadPackages(cardPackages);
        document.getElementById('card-provider-section').style.display = 'block';
        document.getElementById('card-input-section').style.display = 'none';
        document.getElementById('card-history-section').style.display = 'block';
        document.getElementById('mbbank-qr-section').style.display = 'none';
        document.getElementById('mbbank-history-section').style.display = 'none';
        loadCardHistory();
    } else {
        document.getElementById('recharge-section').style.display = 'none';
        document.getElementById('recharge-summary').style.display = 'none';
        document.getElementById('btn-proceed-payment').style.display = 'none';
        document.getElementById('card-provider-section').style.display = 'none';
        document.getElementById('card-input-section').style.display = 'none';
        document.getElementById('card-history-section').style.display = 'none';
        if (!hasPendingTransaction) {
            showMBBankQR();
        } else {
            document.getElementById('mbbank-qr-section').style.display = 'block';
            document.getElementById('mbbank-history-section').style.display = 'block';
        }
    }
    
    updateSummary();
    updateButton();
}

function selectCardProvider(providerId, fee, element) {
    selectedProvider = providerId;
    selectedFee = fee;
    
    document.querySelectorAll('.card-provider').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    
    document.getElementById('card-input-section').style.display = 'block';
    updateSummary();
    updateButton();
}

function updateSummary() {
    const feeAmount = isCardMethod && selectedAmount > 0 ? Math.floor(selectedAmount * selectedFee / 100) : 0;
    const totalReceived = selectedAmount + selectedBonus - feeAmount;
    
    document.getElementById('recharge-amount').textContent = selectedAmount.toLocaleString('vi-VN') + ' ƒë';
    document.getElementById('bonus-amount').textContent = selectedBonus.toLocaleString('vi-VN') + ' ƒë';
    
    if (isCardMethod && selectedFee > 0) {
        document.getElementById('fee-row').style.display = 'flex';
        document.getElementById('fee-percent').textContent = selectedFee;
        document.getElementById('fee-amount').textContent = '-' + feeAmount.toLocaleString('vi-VN') + ' ƒë';
    } else {
        document.getElementById('fee-row').style.display = 'none';
    }
    
    document.getElementById('total-amount').textContent = totalReceived.toLocaleString('vi-VN') + ' ƒë';
    
    updateButton();
}

function updateButton() {
    const btn = document.getElementById('btn-proceed-payment');
    if (isCardMethod) {
        btn.disabled = !(selectedAmount > 0 && selectedMethod && selectedProvider);
    } else {
        btn.disabled = !(selectedAmount > 0 && selectedMethod);
    }
}

let countdownInterval = null;
let transactionCode = '';

function generateTransactionCode() {
    const userId = 'user_6936e60cb24f2';
    const userIdNum = userId.replace(/[^0-9]/g, '').substr(0, 4) || '0000';
    const timestamp = Date.now().toString(36).toUpperCase().substr(-6);
    return `${userIdNum}${timestamp}`;
}

function generateVietQR(content) {
    const stk = '8600112233';
    const contentEncoded = encodeURIComponent(content);
    return `https://img.vietqr.io/image/mb-${stk}-compact.png?addInfo=${contentEncoded}`;
}

function startCountdown(duration) {
    let timeLeft = duration;
    const timerDisplay = document.getElementById('countdown-timer');
    
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }
    
    countdownInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            timerDisplay.textContent = 'H·∫øt h·∫°n';
            timerDisplay.style.color = '#ef4444';
            setTimeout(() => {
                document.getElementById('mbbank-qr-section').style.display = 'none';
                hasPendingTransaction = false;
                clearPendingTransaction();
                
                const proceedBtn = document.getElementById('btn-proceed-payment');
                proceedBtn.style.opacity = '1';
                proceedBtn.style.cursor = 'pointer';
                
                alert('QR Code ƒë√£ h·∫øt h·∫°n. Vui l√≤ng t·∫°o giao d·ªãch m·ªõi.');
            }, 1000);
        } else if (timeLeft <= 60) {
            timerDisplay.style.color = '#fb923c';
        }
        
        timeLeft--;
    }, 1000);
}

function showMBBankQR() {
    transactionCode = generateTransactionCode();
    const qrUrl = generateVietQR(transactionCode);
    
    fetch('api_create_mbbank_transaction.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'same-origin',
        body: JSON.stringify({
            amount: 0,
            bonus_amount: 0,
            transaction_code: transactionCode
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            hasPendingTransaction = true;
            document.getElementById('qr-code-image').src = qrUrl;
            document.getElementById('transaction-code').textContent = transactionCode;
            document.getElementById('mbbank-qr-section').style.display = 'block';
            document.getElementById('mbbank-history-section').style.display = 'block';
            
            const proceedBtn = document.getElementById('btn-proceed-payment');
            if (proceedBtn) {
                proceedBtn.style.display = 'none';
            }
            
            savePendingTransaction({
                transactionCode: transactionCode,
                qrUrl: qrUrl
            });
            
            startAutoCheck();
            
            window.scrollTo({
                top: document.getElementById('mbbank-qr-section').offsetTop - 100,
                behavior: 'smooth'
            });
            
            loadMBBankHistory();
        } else {
            console.error('Transaction error:', data);
            alert(data.message || 'Kh√¥ng th·ªÉ t·∫°o giao d·ªãch. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    })
    .catch(error => {
        console.error('Error creating transaction:', error);
        alert('ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i.');
    });
}

function proceedPayment() {
    if (hasPendingTransaction) {
        Swal.fire({
            icon: 'warning',
            title: 'Giao d·ªãch ƒëang ch·ªù',
            text: 'B·∫°n ƒëang c√≥ giao d·ªãch ch∆∞a ho√†n th√†nh. Vui l√≤ng ho√†n t·∫•t ho·∫∑c h·ªßy giao d·ªãch hi·ªán t·∫°i.',
            confirmButtonColor: '#0ea5e9'
        });
        return;
    }
    
    if (selectedAmount === 0 || !selectedMethod) {
        Swal.fire({
            icon: 'error',
            title: 'Thi·∫øu th√¥ng tin',
            text: 'Vui l√≤ng ch·ªçn m·ªánh gi√° v√† ph∆∞∆°ng th·ª©c thanh to√°n',
            confirmButtonColor: '#0ea5e9'
        });
        return;
    }
    
    if (isCardMethod) {
        if (!selectedProvider) {
            Swal.fire({
                icon: 'error',
                title: 'Thi·∫øu th√¥ng tin',
                text: 'Vui l√≤ng ch·ªçn nh√† m·∫°ng',
                confirmButtonColor: '#0ea5e9'
            });
            return;
        }
        
        const serial = document.getElementById('card-serial').value.trim();
        const code = document.getElementById('card-code').value.trim();
        
        if (!serial || !code) {
            Swal.fire({
                icon: 'error',
                title: 'Thi·∫øu th√¥ng tin',
                text: 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin th·∫ª c√†o',
                confirmButtonColor: '#0ea5e9'
            });
            return;
        }
        
        const proceedBtn = $('#btn-proceed-payment');
        const originalHtml = proceedBtn.html();
        
        proceedBtn.prop('disabled', true);
        proceedBtn.html(`
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 6v6l4 2"></path>
            </svg>
            ƒêang x·ª≠ l√Ω...
        `);
        
        $.ajax({
            url: 'charge.php',
            type: 'POST',
            data: {
                telco: selectedProvider,
                amount: selectedAmount,
                serial: serial,
                code: code
            },
            dataType: 'json',
            success: function(response) {
                proceedBtn.prop('disabled', false);
                proceedBtn.html(originalHtml);
                
                if (response.status === 'success') {
                    const feeAmount = Math.floor(selectedAmount * selectedFee / 100);
                    const totalReceived = selectedAmount + selectedBonus - feeAmount;
                    
                    let message = `M·ªánh gi√°: ${selectedAmount.toLocaleString('vi-VN')} ƒë<br>`;
                    message += `Ph√≠ chi·∫øt kh·∫•u (${selectedFee}%): -${feeAmount.toLocaleString('vi-VN')} ƒë<br>`;
                    if (selectedBonus > 0) {
                        message += `Ti·ªÅn th∆∞·ªüng: +${selectedBonus.toLocaleString('vi-VN')} ƒë<br>`;
                    }
                    message += `<strong>T·ªïng nh·∫≠n: ${totalReceived.toLocaleString('vi-VN')} ƒë</strong>`;
                    
                    if (response.data && response.data.pending) {
                        Swal.fire({
                            icon: 'info',
                            title: 'ƒêang x·ª≠ l√Ω th·∫ª',
                            html: `${response.msg}<br><br>${message}`,
                            confirmButtonColor: '#0ea5e9'
                        });
                    } else {
                        Swal.fire({
                            icon: 'success',
                            title: 'N·∫°p th·∫ª th√†nh c√¥ng!',
                            html: message,
                            confirmButtonColor: '#10b981',
                            timer: 5000
                        }).then(() => {
                            location.reload();
                        });
                    }
                    
                    document.getElementById('card-serial').value = '';
                    document.getElementById('card-code').value = '';
                    
                    setTimeout(loadCardHistory, 500);
                    
                } else if (response.status === 'warning') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Sai m·ªánh gi√°',
                        html: response.msg,
                        confirmButtonColor: '#f59e0b'
                    }).then(() => {
                        location.reload();
                    });
                    
                    document.getElementById('card-serial').value = '';
                    document.getElementById('card-code').value = '';
                    
                    setTimeout(loadCardHistory, 500);
                    
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'L·ªói n·∫°p th·∫ª',
                        text: response.msg || 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i',
                        confirmButtonColor: '#ef4444'
                    });
                }
            },
            error: function(xhr, status, error) {
                proceedBtn.prop('disabled', false);
                proceedBtn.html(originalHtml);
                
                console.error('AJAX Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'L·ªói k·∫øt n·ªëi',
                    text: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i',
                    confirmButtonColor: '#ef4444'
                });
            }
        });
    } else {
        showMBBankQR();
    }
}

function loadCardHistory() {
    const historyList = document.getElementById('card-history-list');
    
    fetch('api_card_history.php', {
        credentials: 'same-origin'
    })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.cards && data.cards.length > 0) {
                let html = '';
                data.cards.forEach(card => {
                    const statusClass = card.status === 'completed' ? 'success' : card.status === 'pending' ? 'warning' : 'error';
                    const statusText = card.status === 'completed' ? 'Ho√†n th√†nh' : card.status === 'pending' ? 'ƒêang x·ª≠ l√Ω' : 'Th·∫•t b·∫°i';
                    const statusColor = card.status === 'completed' ? '#10b981' : card.status === 'pending' ? '#f59e0b' : '#ef4444';
                    const statusBg = card.status === 'completed' ? 'rgba(16, 185, 129, 0.1)' : card.status === 'pending' ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                    const statusIcon = card.status === 'completed' ? 
                        '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>' : 
                        card.status === 'pending' ? 
                        '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>' :
                        '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
                    
                    const safeSerial = escapeHtml(card.card_serial);
                    const safeCreatedAt = escapeHtml(card.created_at);
                    const cardTypeName = card.card_type.charAt(0).toUpperCase() + card.card_type.slice(1);
                    
                    html += `
                        <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 18px; margin-bottom: 14px; transition: all 0.2s; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: linear-gradient(135deg, ${statusBg}, transparent); border-radius: 0 0 0 100%; opacity: 0.5;"></div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; position: relative;">
                                <div style="flex: 1;">
                                    <div style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Nh√† m·∫°ng</div>
                                    <div style="font-weight: 700; color: #f1f5f9; font-size: 16px;">${cardTypeName}</div>
                                    <div style="font-size: 12px; color: #64748b; margin-top: 4px; font-family: 'Courier New', monospace;">Serial: ${safeSerial}</div>
                                </div>
                                <div style="background: ${statusBg}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 6px; border: 1px solid ${statusColor};">
                                    ${statusIcon}
                                    ${statusText}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px;">
                                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 4px;">M·ªánh gi√°</div>
                                    <div style="color: #f1f5f9; font-weight: 600; font-size: 15px;">${parseInt(card.amount).toLocaleString('vi-VN')} ƒë</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px;">
                                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 4px;">Ph√≠ (${card.fee_percent}%)</div>
                                    <div style="color: #ef4444; font-weight: 600; font-size: 15px;">-${Math.floor(parseInt(card.amount) * card.fee_percent / 100).toLocaleString('vi-VN')} ƒë</div>
                                </div>
                            </div>
                            
                            ${card.status === 'completed' && card.received_amount > 0 ? `
                            <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 10px; padding: 12px; margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #6ee7b7; font-size: 13px; font-weight: 500;">ƒê√£ nh·∫≠n</span>
                                    <span style="color: #10b981; font-weight: 700; font-size: 18px;">${parseInt(card.received_amount).toLocaleString('vi-VN')} ƒë</span>
                                </div>
                            </div>
                            ` : ''}
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 13px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    ${safeCreatedAt}
                                </div>
                            </div>
                        </div>
                    `;
                });
                historyList.innerHTML = html;
            } else {
                historyList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ n·∫°p th·∫ª</p>';
            }
        })
        .catch(error => {
            console.error('Error loading card history:', error);
            historyList.innerHTML = '<p style="text-align: center; color: #ef4444; padding: 20px;">Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠ n·∫°p th·∫ª</p>';
        });
}

// Copy to clipboard function
function copyToClipboard(text, successMessage = 'ƒê√£ sao ch√©p!') {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
            showCopyNotification(successMessage);
        }).catch(err => {
            fallbackCopyTextToClipboard(text, successMessage);
        });
    } else {
        fallbackCopyTextToClipboard(text, successMessage);
    }
}

function fallbackCopyTextToClipboard(text, successMessage) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.top = '-9999px';
    textArea.style.left = '-9999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        document.execCommand('copy');
        showCopyNotification(successMessage);
    } catch (err) {
        alert('Kh√¥ng th·ªÉ sao ch√©p. Vui l√≤ng sao ch√©p th·ªß c√¥ng.');
    }
    
    document.body.removeChild(textArea);
}

function showCopyNotification(message) {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px 24px; border-radius: 12px; font-weight: 600; z-index: 10000; box-shadow: 0 10px 25px rgba(0,0,0,0.3); animation: slideInRight 0.3s ease-out;';
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 2000);
}

function copyTransactionCode() {
    const code = document.getElementById('transaction-code').textContent;
    copyToClipboard(code, 'ƒê√£ sao ch√©p n·ªôi dung chuy·ªÉn kho·∫£n!');
}

function copyTransferAmount() {
    const amount = selectedAmount.toString();
    copyToClipboard(amount, 'ƒê√£ sao ch√©p s·ªë ti·ªÅn!');
}

function downloadQRCode() {
    const qrImage = document.getElementById('qr-code-image');
    const qrUrl = qrImage.src;
    
    if (!qrUrl) {
        alert('QR Code ch∆∞a ƒë∆∞·ª£c t·∫°o!');
        return;
    }
    
    fetch(qrUrl)
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `QR_MBBank_${transactionCode}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showCopyNotification('ƒê√£ t·∫£i ·∫£nh QR Code!');
        })
        .catch(error => {
            console.error('Error downloading QR code:', error);
            alert('Kh√¥ng th·ªÉ t·∫£i ·∫£nh QR. Vui l√≤ng th·ª≠ l·∫°i.');
        });
}

function startAutoCheck() {
    if (autoCheckInterval) {
        clearInterval(autoCheckInterval);
    }
    
    autoCheckInterval = setInterval(() => {
        if (transactionCode && hasPendingTransaction) {
            checkTransactionStatusSilent();
        }
    }, 3000);
}

function stopAutoCheck() {
    if (autoCheckInterval) {
        clearInterval(autoCheckInterval);
        autoCheckInterval = null;
    }
}

function cancelMBBankTransaction() {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy giao d·ªãch n√†y?')) {
        stopAutoCheck();
        
        if (transactionCode) {
            fetch('api_cancel_mbbank_transaction.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin',
                body: JSON.stringify({
                    transaction_code: transactionCode
                })
            }).catch(error => {
                console.error('Error cancelling transaction:', error);
            });
        }
        
        document.getElementById('mbbank-qr-section').style.display = 'none';
        document.getElementById('mbbank-history-section').style.display = 'none';
        transactionCode = '';
        hasPendingTransaction = false;
        
        clearPendingTransaction();
        
        document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
        selectedMethod = '';
        
        showCopyNotification('ƒê√£ h·ªßy giao d·ªãch');
    }
}

function cancelMBBankHistoryTransaction(txCode) {
    if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy giao d·ªãch ${txCode}?`)) {
        fetch('api_cancel_mbbank_transaction.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'same-origin',
            body: JSON.stringify({
                transaction_code: txCode
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showCopyNotification('ƒê√£ h·ªßy giao d·ªãch th√†nh c√¥ng');
                // Reload history
                setTimeout(() => {
                    loadMBBankHistory();
                }, 1000);
            } else {
                showCopyNotification(data.message || 'L·ªói khi h·ªßy giao d·ªãch');
            }
        })
        .catch(error => {
            console.error('Error cancelling transaction:', error);
            showCopyNotification('L·ªói khi h·ªßy giao d·ªãch');
        });
    }
}

function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}

function loadMBBankHistory() {
    const historyList = document.getElementById('mbbank-history-list');
    
    fetch('api_mbbank_history.php', {
        credentials: 'same-origin'
    })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.transactions && data.transactions.length > 0) {
                let html = '';
                data.transactions.forEach(tx => {
                    const expiresAt = new Date(tx.expires_at).getTime();
                    const now = Date.now();
                    const isExpired = now > expiresAt;
                    
                    let displayStatus = tx.status;
                    if (tx.status === 'pending' && isExpired) {
                        displayStatus = 'expired';
                    }
                    
                    let statusText, statusColor, statusBg, statusIcon;
                    
                    switch(displayStatus) {
                        case 'completed':
                            statusText = 'Th√†nh c√¥ng';
                            statusColor = '#10b981';
                            statusBg = 'rgba(16, 185, 129, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
                            break;
                        case 'pending':
                            statusText = 'ƒêang ch·ªù';
                            statusColor = '#f59e0b';
                            statusBg = 'rgba(245, 158, 11, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>';
                            break;
                        case 'expired':
                            statusText = 'ƒê√£ h·∫øt h·∫°n';
                            statusColor = '#94a3b8';
                            statusBg = 'rgba(148, 163, 184, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
                            break;
                        case 'failed':
                            statusText = 'Th·∫•t b·∫°i';
                            statusColor = '#ef4444';
                            statusBg = 'rgba(239, 68, 68, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
                            break;
                        case 'cancelled':
                            statusText = 'ƒê√£ h·ªßy';
                            statusColor = '#64748b';
                            statusBg = 'rgba(100, 116, 139, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
                            break;
                        default:
                            statusText = 'Kh√¥ng x√°c ƒë·ªãnh';
                            statusColor = '#64748b';
                            statusBg = 'rgba(100, 116, 139, 0.1)';
                            statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
                    }
                    
                    const safeTxCode = escapeHtml(tx.transaction_code);
                    const safeCreatedAt = escapeHtml(tx.created_at);
                    const isPending = tx.status === 'pending';
                    
                    html += `
                        <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 18px; margin-bottom: 14px; transition: all 0.2s; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: linear-gradient(135deg, ${statusBg}, transparent); border-radius: 0 0 0 100%; opacity: 0.5;"></div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; position: relative;">
                                <div style="flex: 1;">
                                    <div style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">M√£ giao d·ªãch</div>
                                    <div style="font-weight: 700; color: #f1f5f9; font-size: 16px; font-family: 'Courier New', monospace; letter-spacing: 1px;">${safeTxCode}</div>
                                </div>
                                <div style="background: ${statusBg}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 6px; border: 1px solid ${statusColor};">
                                    ${statusIcon}
                                    ${statusText}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px;">
                                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 4px;">S·ªë ti·ªÅn n·∫°p</div>
                                    <div style="color: #f1f5f9; font-weight: 600; font-size: 15px;">${parseInt(tx.amount).toLocaleString('vi-VN')} ƒë</div>
                                </div>
                                ${tx.bonus_amount > 0 ? `
                                <div style="background: rgba(16, 185, 129, 0.05); border-radius: 10px; padding: 12px; border: 1px solid rgba(16, 185, 129, 0.2);">
                                    <div style="color: #6ee7b7; font-size: 12px; margin-bottom: 4px;">Ti·ªÅn th∆∞·ªüng</div>
                                    <div style="color: #10b981; font-weight: 600; font-size: 15px;">+${parseInt(tx.bonus_amount).toLocaleString('vi-VN')} ƒë</div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div style="background: rgba(14, 165, 233, 0.1); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 10px; padding: 12px; margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #7dd3fc; font-size: 13px; font-weight: 500;">T·ªïng nh·∫≠n ƒë∆∞·ª£c</span>
                                    <span style="color: #0ea5e9; font-weight: 700; font-size: 18px;">${parseInt(tx.total_amount).toLocaleString('vi-VN')} ƒë</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 13px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    ${safeCreatedAt}
                                </div>
                                ${isPending && !isExpired ? `
                                <button onclick="cancelMBBankHistoryTransaction('${safeTxCode}')" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: all 0.2s;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    H·ªßy
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                historyList.innerHTML = html;
            } else {
                historyList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 20px;">Ch∆∞a c√≥ l·ªãch s·ª≠ giao d·ªãch</p>';
            }
        })
        .catch(error => {
            console.error('Error loading MBBank history:', error);
            historyList.innerHTML = '<p style="text-align: center; color: #ef4444; padding: 20px;">Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠ giao d·ªãch</p>';
        });
}

function savePendingTransaction(data) {
    try {
        localStorage.setItem('mbbank_pending_transaction', JSON.stringify(data));
    } catch (e) {
        console.error('Error saving to localStorage:', e);
    }
}

function clearPendingTransaction() {
    try {
        localStorage.removeItem('mbbank_pending_transaction');
    } catch (e) {
        console.error('Error clearing localStorage:', e);
    }
}

function loadPendingTransaction() {
    try {
        const savedData = localStorage.getItem('mbbank_pending_transaction');
        if (!savedData) return;
        
        const data = JSON.parse(savedData);
        
        transactionCode = data.transactionCode;
        hasPendingTransaction = true;
        
        document.getElementById('qr-code-image').src = data.qrUrl;
        document.getElementById('transaction-code').textContent = data.transactionCode;
        document.getElementById('mbbank-qr-section').style.display = 'block';
        document.getElementById('mbbank-history-section').style.display = 'block';
        
        const proceedBtn = document.getElementById('btn-proceed-payment');
        if (proceedBtn) {
            proceedBtn.style.display = 'none';
        }
        
        startAutoCheck();
        
        loadMBBankHistory();
    } catch (e) {
        console.error('Error loading from localStorage:', e);
        clearPendingTransaction();
    }
}

function showSuccessAnimation(amount, bonusAmount = 0, callback = null) {
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 99999;
        display: flex; align-items: center; justify-content: center;
        animation: fadeIn 0.3s ease-out; backdrop-filter: blur(10px);
    `;
    
    const successBox = document.createElement('div');
    successBox.style.cssText = `
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        padding: 45px 70px; border-radius: 28px;
        box-shadow: 0 25px 70px rgba(16, 185, 129, 0.5);
        text-align: center; color: white;
        animation: scaleIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        max-width: 90%; position: relative; overflow: hidden;
    `;
    
    let bonusDisplay = '';
    if (bonusAmount > 0) {
        bonusDisplay = `
            <div style="margin-top: 18px; padding: 14px; background: rgba(255,255,255,0.15); border-radius: 14px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3);">
                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px;">üéÅ Ti·ªÅn th∆∞·ªüng</div>
                <div style="font-size: 24px; font-weight: 700; color: #fbbf24;">+${parseInt(bonusAmount).toLocaleString('vi-VN')} ƒë</div>
            </div>
        `;
    }
    
    successBox.innerHTML = `
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: successRing 2s ease-out infinite;"></div>
        <div style="margin-bottom: 24px; display: flex; justify-content: center; align-items: center;">
            <svg width="110" height="110" viewBox="0 0 100 100" style="animation: successPulse 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); display: block; margin: 0 auto;">
                <circle cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="3" opacity="0.2" style="animation: successRing 1.5s ease-out infinite;"/>
                <circle cx="50" cy="50" r="35" fill="white" style="animation: successCircle 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);"/>
                <path d="M 30 50 L 43 63 L 70 36" fill="none" stroke="#10b981" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" style="animation: successCheck 0.6s ease-out 0.3s both;"/>
            </svg>
        </div>
        <div style="font-size: 28px; font-weight: 700; margin-bottom: 16px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">N·∫°p ti·ªÅn th√†nh c√¥ng!</div>
        <div style="font-size: 38px; font-weight: 800; color: #fef3c7; text-shadow: 0 3px 15px rgba(251, 191, 36, 0.4);">${parseInt(amount).toLocaleString('vi-VN')} ƒë</div>
        ${bonusDisplay}
        <div style="font-size: 15px; margin-top: 20px; opacity: 0.95; font-weight: 500;">S·ªë d∆∞ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√†o t√†i kho·∫£n</div>
    `;
    
    overlay.appendChild(successBox);
    document.body.appendChild(overlay);
    
    createConfetti();
    
    setTimeout(() => {
        overlay.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => {
            if (overlay.parentNode) {
                document.body.removeChild(overlay);
            }
            if (callback) {
                callback();
            } else {
                location.reload();
            }
        }, 300);
    }, 3500);
}

function createConfetti() {
    const colors = ['#fbbf24', '#10b981', '#0ea5e9', '#f59e0b', '#8b5cf6'];
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.style.cssText = `
                position: fixed;
                width: 10px;
                height: 10px;
                background: ${colors[Math.floor(Math.random() * colors.length)]};
                left: ${Math.random() * 100}%;
                top: -10px;
                opacity: 1;
                border-radius: 50%;
                animation: confettiFall ${2 + Math.random() * 2}s linear forwards;
                z-index: 100000;
            `;
            document.body.appendChild(confetti);
            setTimeout(() => {
                if (confetti.parentNode) {
                    document.body.removeChild(confetti);
                }
            }, 4000);
        }, i * 30);
    }
}

function handleTransactionComplete(data) {
    stopAutoCheck();
    
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }
    
    clearPendingTransaction();
    hasPendingTransaction = false;
    
    const amount = data.transaction.total_amount;
    const bonusAmount = data.transaction.bonus_amount || 0;
    const statusMessage = data.transaction.status_message || 'N·∫°p ti·ªÅn th√†nh c√¥ng';
    
    if (statusMessage.includes('70%')) {
        alert(`‚ö†Ô∏è ${statusMessage}\n\nS·ªë ti·ªÅn nh·∫≠n ƒë∆∞·ª£c: ${parseInt(amount).toLocaleString('vi-VN')} ƒë\n\n(B·∫°n ƒë√£ chuy·ªÉn sai s·ªë ti·ªÅn n√™n ch·ªâ ƒë∆∞·ª£c c·ªông 70%)`);
        setTimeout(() => location.reload(), 2000);
    } else {
        showSuccessAnimation(amount, bonusAmount, () => {
            document.getElementById('mbbank-qr-section').style.display = 'none';
            const historySection = document.getElementById('mbbank-history-section');
            if (historySection) {
                historySection.style.display = 'block';
                historySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            const proceedBtn = document.getElementById('btn-proceed-payment');
            proceedBtn.style.opacity = '1';
            proceedBtn.style.cursor = 'pointer';
            
            loadMBBankHistory();
            
            Toast.success('N·∫°p ti·ªÅn th√†nh c√¥ng!', `ƒê√£ c·ªông ${parseInt(amount).toLocaleString('vi-VN')} ƒë v√†o t√†i kho·∫£n`, 5000);
        });
    }
}

function checkTransactionStatusSilent() {
    if (!transactionCode) return;
    
    fetch('api_check_mbbank_status.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'same-origin',
        body: JSON.stringify({
            transaction_code: transactionCode
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.status === 'completed') {
                handleTransactionComplete(data);
            } else if (data.status === 'expired') {
                stopAutoCheck();
                showCopyNotification('Giao d·ªãch ƒë√£ h·∫øt h·∫°n');
                setTimeout(() => {
                    clearPendingTransaction();
                    document.getElementById('mbbank-qr-section').style.display = 'none';
                    hasPendingTransaction = false;
                    
                    const proceedBtn = document.getElementById('btn-proceed-payment');
                    proceedBtn.style.opacity = '1';
                    proceedBtn.style.cursor = 'pointer';
                }, 1500);
            } else if (data.status === 'failed') {
                stopAutoCheck();
                showCopyNotification('‚ùå Giao d·ªãch th·∫•t b·∫°i: ' + (data.transaction.status_message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh'));
            }
        }
    })
    .catch(error => {
        console.error('Error checking status:', error);
    });
}

function checkTransactionStatus() {
    if (!transactionCode) {
        showCopyNotification('Kh√¥ng t√¨m th·∫•y m√£ giao d·ªãch');
        return;
    }
    
    const btn = document.getElementById('btn-check-status');
    const originalText = btn.innerHTML;
    
    btn.disabled = true;
    btn.style.opacity = '0.6';
    btn.innerHTML = `
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
        ƒêang ki·ªÉm tra...
    `;
    
    fetch('api_check_mbbank_status.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'same-origin',
        body: JSON.stringify({
            transaction_code: transactionCode
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.status === 'completed') {
                showCopyNotification('‚úì Giao d·ªãch ƒë√£ ho√†n th√†nh!');
                setTimeout(() => {
                    handleTransactionComplete(data);
                }, 500);
            } else if (data.status === 'pending') {
                showCopyNotification('Giao d·ªãch ƒëang ch·ªù x√°c nh·∫≠n. Vui l√≤ng ki·ªÉm tra l·∫°i sau.');
            } else if (data.status === 'expired') {
                stopAutoCheck();
                showCopyNotification('Giao d·ªãch ƒë√£ h·∫øt h·∫°n');
                setTimeout(() => {
                    clearPendingTransaction();
                    document.getElementById('mbbank-qr-section').style.display = 'none';
                    hasPendingTransaction = false;
                    
                    const proceedBtn = document.getElementById('btn-proceed-payment');
                    proceedBtn.style.opacity = '1';
                    proceedBtn.style.cursor = 'pointer';
                }, 1500);
            } else if (data.status === 'failed') {
                stopAutoCheck();
                showCopyNotification('‚ùå Giao d·ªãch th·∫•t b·∫°i: ' + (data.transaction.status_message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh'));
            }
            
            loadMBBankHistory();
        } else {
            showCopyNotification(data.message || 'Kh√¥ng th·ªÉ ki·ªÉm tra tr·∫°ng th√°i');
        }
    })
    .catch(error => {
        console.error('Error checking status:', error);
        showCopyNotification('L·ªói khi ki·ªÉm tra tr·∫°ng th√°i. Vui l√≤ng th·ª≠ l·∫°i.');
    })
    .finally(() => {
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.innerHTML = originalText;
    });
}

let uploadedImages = [];

function reportPaymentError() {
    if (!transactionCode || !selectedAmount) {
        Toast.error('L·ªói', 'Kh√¥ng t√¨m th·∫•y th√¥ng tin giao d·ªãch ƒë·ªÉ b√°o l·ªói');
        return;
    }
    document.getElementById('error-description').value = '';
    document.getElementById('error-images').value = '';
    document.getElementById('image-preview-container').innerHTML = '';
    uploadedImages = [];
    document.getElementById('errorReportModal').style.display = 'flex';
}

function closeErrorReportModal() {
    document.getElementById('errorReportModal').style.display = 'none';
}

function handleImageUpload(event) {
    const files = Array.from(event.target.files);
    const maxFiles = 3;
    
    if (files.length > maxFiles) {
        Toast.error('L·ªói', `Ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa ${maxFiles} ·∫£nh`);
        event.target.value = '';
        return;
    }
    
    const previewContainer = document.getElementById('image-preview-container');
    previewContainer.innerHTML = '';
    uploadedImages = [];
    
    files.forEach((file, index) => {
        if (file.size > 5 * 1024 * 1024) {
            Toast.error('L·ªói', `File ${file.name} qu√° l·ªõn. T·ªëi ƒëa 5MB`);
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewDiv = document.createElement('div');
            previewDiv.style.cssText = 'position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1; border: 2px solid rgba(14, 165, 233, 0.3);';
            previewDiv.innerHTML = `
                <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
                <button onclick="removeImage(${index})" style="position: absolute; top: 4px; right: 4px; background: rgba(239, 68, 68, 0.9); border: none; color: white; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; padding: 0;">√ó</button>
            `;
            previewContainer.appendChild(previewDiv);
        };
        reader.readAsDataURL(file);
        
        uploadedImages.push(file);
    });
}

function removeImage(index) {
    uploadedImages.splice(index, 1);
    const fileInput = document.getElementById('error-images');
    const dt = new DataTransfer();
    uploadedImages.forEach(file => dt.items.add(file));
    fileInput.files = dt.files;
    
    const event = new Event('change');
    fileInput.dispatchEvent(event);
}

async function uploadImages() {
    const uploadedPaths = [];
    
    for (const file of uploadedImages) {
        const formData = new FormData();
        formData.append('image', file);
        
        try {
            const response = await fetch('api_upload_image.php', {
                method: 'POST',
                credentials: 'same-origin',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                uploadedPaths.push(data.file_path);
            } else {
                console.error('Upload failed:', data.message);
            }
        } catch (error) {
            console.error('Upload error:', error);
        }
    }
    
    return uploadedPaths;
}

async function submitErrorReport() {
    const description = document.getElementById('error-description').value.trim();
    
    if (!description) {
        Toast.error('L·ªói', 'Vui l√≤ng m√¥ t·∫£ v·∫•n ƒë·ªÅ b·∫°n g·∫∑p ph·∫£i');
        return;
    }
    
    if (description.length < 10) {
        Toast.error('L·ªói', 'M√¥ t·∫£ qu√° ng·∫Øn. Vui l√≤ng cung c·∫•p th√™m th√¥ng tin');
        return;
    }
    
    showPageLoading();
    
    try {
        let imagePaths = [];
        if (uploadedImages.length > 0) {
            imagePaths = await uploadImages();
        }
        
        const response = await fetch('api_report_error.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'same-origin',
            body: JSON.stringify({
                transaction_code: transactionCode,
                bill_images: imagePaths,
                content: description
            })
        });
        
        const data = await response.json();
        hidePageLoading();
        
        if (data.success) {
            closeErrorReportModal();
            Toast.success('Th√†nh c√¥ng!', data.message, 5000);
        } else {
            Toast.error('L·ªói', data.message);
        }
    } catch (error) {
        hidePageLoading();
        console.error('Error submitting report:', error);
        Toast.error('L·ªói', 'Kh√¥ng th·ªÉ g·ª≠i b√°o c√°o. Vui l√≤ng th·ª≠ l·∫°i');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadPendingTransaction();
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
});
</script>

    </div>

    <!-- Footer Information -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3 class="footer-title">C√îNG TY C√îNG NGH·ªÜ CuTools</h3>
                <div class="footer-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <span>2862 Larimer St, Denver, Colorado 80205, USA</span>
                </div>
                <div class="footer-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <a href="/cdn-cgi/l/email-protection#bfd6d1d9d0fffccaebd0d0d3cc91d3d0d3"><span class="__cf_email__" data-cfemail="0c65626a634c4f79586363607f22606360">[email&#160;protected]</span></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3 class="footer-title">LI√äN H·ªÜ</h3>
                <div class="footer-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <a href="/cdn-cgi/l/email-protection#cba2a5ada48b88be9fa4a4a7b8e5a7a4a7"><span class="__cf_email__" data-cfemail="81e8efe7eec1c2f4d5eeeeedf2afedeeed">[email&#160;protected]</span></a>
                </div>
                <div class="footer-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                    <a href="tel:0382453807">0382453807</a>
                </div>
                <div class="footer-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 0 0-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
                    </svg>
                    <a href="https://t.me/mryanhdz" target="_blank">Telegram Admin</a>
                </div>
            </div>
        </div>
        
        <div class="footer-links">
            <a href="?page=about">V·ªÅ ch√∫ng t√¥i</a>
            <span>‚Ä¢</span>
            <a href="?page=tos">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
            <span>‚Ä¢</span>
            <a href="?page=privacy">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
            <span>‚Ä¢</span>
            <a href="?page=support">H·ªó tr·ª£</a>
        </div>
        
        <div class="footer-copyright">
            Copyright ¬© 2025 CuTools.lol
        </div>
    </footer>

        <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="?page=home" class="nav-item ">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Trang ch·ªß</span>
        </a>
        <a href="?page=keymanager" class="nav-item ">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h18v18H3zM9 3v18"></path>
                <path d="M9 9h12M9 15h12"></path>
            </svg>
            <span>Qu·∫£n l√Ω</span>
        </a>
        <div class="nav-item nav-balance">
                        <div class="key-badge key-none">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                </svg>
                <span>None</span>
            </div>
        </div>
        <a href="?page=deposit" class="nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
            <span>N·∫°p ti·ªÅn</span>
        </a>
        <a href="?page=profile" class="nav-item ">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Th√¥ng tin</span>
        </a>
    </nav>
    
    <!-- Loading Overlay -->
    <div id="page-loading-overlay" class="page-loading-overlay">
        <div class="loading-spinner-container">
            <div class="loading-spinner">
                <svg class="spinner-ring" viewBox="0 0 50 50">
                    <circle class="spinner-path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
                </svg>
            </div>
            <div class="loading-text">ƒêang t·∫£i...</div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

        <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="serve_static.php?file=script.js&v=1764979622"></script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ab54abd7b09ff85',t:'MTc2NTI5MTU4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9ab54abd7b09ff85","version":"2025.9.1","r":1,"token":"c30428b3c9a143e99de5726a2a58f33e","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}}}' crossorigin="anonymous"></script>
</body>
</html>
